{"remainingRequest":"E:\\01_PERCEPTRON\\Code\\PerceptronFrontEnd\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js??ref--3-1!E:\\01_PERCEPTRON\\Code\\PerceptronFrontEnd\\node_modules\\rxjs\\_esm5\\observable\\dom\\WebSocketSubject.js","dependencies":[{"path":"E:\\01_PERCEPTRON\\Code\\PerceptronFrontEnd\\node_modules\\rxjs\\_esm5\\observable\\dom\\WebSocketSubject.js","mtime":1532940287264},{"path":"E:\\01_PERCEPTRON\\Code\\PerceptronFrontEnd\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1532940271448},{"path":"E:\\01_PERCEPTRON\\Code\\PerceptronFrontEnd\\node_modules\\@angular-devkit\\build-optimizer\\src\\build-optimizer\\webpack-loader.js","mtime":1532940256149}],"contextDependencies":[],"result":["import { __extends } from \"tslib\";\r\nimport { Subject, AnonymousSubject } from '../../Subject';\r\nimport { Subscriber } from '../../Subscriber';\r\nimport { Observable } from '../../Observable';\r\nimport { Subscription } from '../../Subscription';\r\nimport { root } from '../../util/root';\r\nimport { ReplaySubject } from '../../ReplaySubject';\r\nimport { tryCatch } from '../../util/tryCatch';\r\nimport { errorObject } from '../../util/errorObject';\r\nimport { assign } from '../../util/assign';\r\n/**\r\n * We need this JSDoc comment for affecting ESDoc.\r\n * @extends {Ignored}\r\n * @hide true\r\n */\r\nexport var WebSocketSubject = /*@__PURE__*/ (function (_super) {\r\n    __extends(WebSocketSubject, _super);\r\n    function WebSocketSubject(urlConfigOrSource, destination) {\r\n        if (urlConfigOrSource instanceof Observable) {\r\n            _super.call(this, destination, urlConfigOrSource);\r\n        }\r\n        else {\r\n            _super.call(this);\r\n            this.WebSocketCtor = root.WebSocket;\r\n            this._output = new Subject();\r\n            if (typeof urlConfigOrSource === 'string') {\r\n                this.url = urlConfigOrSource;\r\n            }\r\n            else {\r\n                // WARNING: config object could override important members here.\r\n                assign(this, urlConfigOrSource);\r\n            }\r\n            if (!this.WebSocketCtor) {\r\n                throw new Error('no WebSocket constructor can be found');\r\n            }\r\n            this.destination = new ReplaySubject();\r\n        }\r\n    }\r\n    WebSocketSubject.prototype.resultSelector = function (e) {\r\n        return JSON.parse(e.data);\r\n    };\r\n    /**\r\n     * Wrapper around the w3c-compatible WebSocket object provided by the browser.\r\n     *\r\n     * @example <caption>Wraps browser WebSocket</caption>\r\n     *\r\n     * let socket$ = Observable.webSocket('ws://localhost:8081');\r\n     *\r\n     * socket$.subscribe(\r\n     *    (msg) => console.log('message received: ' + msg),\r\n     *    (err) => console.log(err),\r\n     *    () => console.log('complete')\r\n     *  );\r\n     *\r\n     * socket$.next(JSON.stringify({ op: 'hello' }));\r\n     *\r\n     * @example <caption>Wraps WebSocket from nodejs-websocket (using node.js)</caption>\r\n     *\r\n     * import { w3cwebsocket } from 'websocket';\r\n     *\r\n     * let socket$ = Observable.webSocket({\r\n     *   url: 'ws://localhost:8081',\r\n     *   WebSocketCtor: w3cwebsocket\r\n     * });\r\n     *\r\n     * socket$.subscribe(\r\n     *    (msg) => console.log('message received: ' + msg),\r\n     *    (err) => console.log(err),\r\n     *    () => console.log('complete')\r\n     *  );\r\n     *\r\n     * socket$.next(JSON.stringify({ op: 'hello' }));\r\n     *\r\n     * @param {string | WebSocketSubjectConfig} urlConfigOrSource the source of the websocket as an url or a structure defining the websocket object\r\n     * @return {WebSocketSubject}\r\n     * @static true\r\n     * @name webSocket\r\n     * @owner Observable\r\n     */\r\n    WebSocketSubject.create = function (urlConfigOrSource) {\r\n        return new WebSocketSubject(urlConfigOrSource);\r\n    };\r\n    WebSocketSubject.prototype.lift = function (operator) {\r\n        var sock = new WebSocketSubject(this, this.destination);\r\n        sock.operator = operator;\r\n        return sock;\r\n    };\r\n    WebSocketSubject.prototype._resetState = function () {\r\n        this.socket = null;\r\n        if (!this.source) {\r\n            this.destination = new ReplaySubject();\r\n        }\r\n        this._output = new Subject();\r\n    };\r\n    // TODO: factor this out to be a proper Operator/Subscriber implementation and eliminate closures\r\n    WebSocketSubject.prototype.multiplex = function (subMsg, unsubMsg, messageFilter) {\r\n        var self = this;\r\n        return new Observable(function (observer) {\r\n            var result = tryCatch(subMsg)();\r\n            if (result === errorObject) {\r\n                observer.error(errorObject.e);\r\n            }\r\n            else {\r\n                self.next(result);\r\n            }\r\n            var subscription = self.subscribe(function (x) {\r\n                var result = tryCatch(messageFilter)(x);\r\n                if (result === errorObject) {\r\n                    observer.error(errorObject.e);\r\n                }\r\n                else if (result) {\r\n                    observer.next(x);\r\n                }\r\n            }, function (err) { return observer.error(err); }, function () { return observer.complete(); });\r\n            return function () {\r\n                var result = tryCatch(unsubMsg)();\r\n                if (result === errorObject) {\r\n                    observer.error(errorObject.e);\r\n                }\r\n                else {\r\n                    self.next(result);\r\n                }\r\n                subscription.unsubscribe();\r\n            };\r\n        });\r\n    };\r\n    WebSocketSubject.prototype._connectSocket = function () {\r\n        var _this = this;\r\n        var WebSocketCtor = this.WebSocketCtor;\r\n        var observer = this._output;\r\n        var socket = null;\r\n        try {\r\n            socket = this.protocol ?\r\n                new WebSocketCtor(this.url, this.protocol) :\r\n                new WebSocketCtor(this.url);\r\n            this.socket = socket;\r\n            if (this.binaryType) {\r\n                this.socket.binaryType = this.binaryType;\r\n            }\r\n        }\r\n        catch (e) {\r\n            observer.error(e);\r\n            return;\r\n        }\r\n        var subscription = new Subscription(function () {\r\n            _this.socket = null;\r\n            if (socket && socket.readyState === 1) {\r\n                socket.close();\r\n            }\r\n        });\r\n        socket.onopen = function (e) {\r\n            var openObserver = _this.openObserver;\r\n            if (openObserver) {\r\n                openObserver.next(e);\r\n            }\r\n            var queue = _this.destination;\r\n            _this.destination = Subscriber.create(function (x) { return socket.readyState === 1 && socket.send(x); }, function (e) {\r\n                var closingObserver = _this.closingObserver;\r\n                if (closingObserver) {\r\n                    closingObserver.next(undefined);\r\n                }\r\n                if (e && e.code) {\r\n                    socket.close(e.code, e.reason);\r\n                }\r\n                else {\r\n                    observer.error(new TypeError('WebSocketSubject.error must be called with an object with an error code, ' +\r\n                        'and an optional reason: { code: number, reason: string }'));\r\n                }\r\n                _this._resetState();\r\n            }, function () {\r\n                var closingObserver = _this.closingObserver;\r\n                if (closingObserver) {\r\n                    closingObserver.next(undefined);\r\n                }\r\n                socket.close();\r\n                _this._resetState();\r\n            });\r\n            if (queue && queue instanceof ReplaySubject) {\r\n                subscription.add(queue.subscribe(_this.destination));\r\n            }\r\n        };\r\n        socket.onerror = function (e) {\r\n            _this._resetState();\r\n            observer.error(e);\r\n        };\r\n        socket.onclose = function (e) {\r\n            _this._resetState();\r\n            var closeObserver = _this.closeObserver;\r\n            if (closeObserver) {\r\n                closeObserver.next(e);\r\n            }\r\n            if (e.wasClean) {\r\n                observer.complete();\r\n            }\r\n            else {\r\n                observer.error(e);\r\n            }\r\n        };\r\n        socket.onmessage = function (e) {\r\n            var result = tryCatch(_this.resultSelector)(e);\r\n            if (result === errorObject) {\r\n                observer.error(errorObject.e);\r\n            }\r\n            else {\r\n                observer.next(result);\r\n            }\r\n        };\r\n    };\r\n    WebSocketSubject.prototype._subscribe = function (subscriber) {\r\n        var _this = this;\r\n        var source = this.source;\r\n        if (source) {\r\n            return source.subscribe(subscriber);\r\n        }\r\n        if (!this.socket) {\r\n            this._connectSocket();\r\n        }\r\n        var subscription = new Subscription();\r\n        subscription.add(this._output.subscribe(subscriber));\r\n        subscription.add(function () {\r\n            var socket = _this.socket;\r\n            if (_this._output.observers.length === 0) {\r\n                if (socket && socket.readyState === 1) {\r\n                    socket.close();\r\n                }\r\n                _this._resetState();\r\n            }\r\n        });\r\n        return subscription;\r\n    };\r\n    WebSocketSubject.prototype.unsubscribe = function () {\r\n        var _a = this, source = _a.source, socket = _a.socket;\r\n        if (socket && socket.readyState === 1) {\r\n            socket.close();\r\n            this._resetState();\r\n        }\r\n        _super.prototype.unsubscribe.call(this);\r\n        if (!source) {\r\n            this.destination = new ReplaySubject();\r\n        }\r\n    };\r\n    return WebSocketSubject;\r\n}(AnonymousSubject));\r\n//# sourceMappingURL=WebSocketSubject.js.map \r\n",null]}